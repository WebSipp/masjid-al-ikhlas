<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <!-- META TAG UNTUK SEMUA DEVICE -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Display Digital Masjid Baiturrahman</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #1A4D8C;
            --primary-light: #5D8DC0;
            --accent-blue: #2E77BB;
            --text-dark: #2C3E50;
            --text-light: #F8F9FA;
            --bg-white: #FFFFFF;
            --bg-light: #F0F4F8;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.85);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(135deg, #F0F4F8 0%, #E3EAF2 100%);
            color: var(--text-dark);
        }
        
        /* LAYOUT UTAMA - FLEX COLUMN */
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* HEADER - AUTO HEIGHT */
        .header {
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        
        .date-section {
            display: flex;
            flex-direction: column;
        }
        
        .hijri-date {
            font-size: 1.5rem;
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }
        
        .gregorian-date {
            font-size: 1.2rem;
            color: var(--text-dark);
            font-weight: 600;
            opacity: 0.9;
        }
        
        .masjid-section {
            text-align: right;
        }
        
        .masjid-name {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 2.2rem;
            color: var(--primary-dark);
            line-height: 1.1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.5px;
        }
        
        .masjid-address {
            font-size: 1rem;
            color: var(--text-dark);
            margin-top: 5px;
            font-weight: 500;
            opacity: 0.85;
        }
        
        /* MAIN CONTAINER - AMBIL SEMUA RUANG TERSISA */
        .main-container {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
            min-height: 0;
            overflow: hidden;
        }
        
        /* SIDEBAR KIRI - 35% */
        .sidebar-left {
            width: 35%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 0;
        }
        
        /* TIMER SECTION */
        .timer-section {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex: 1;
        }
        
        .clock-container {
            margin-bottom: 25px;
        }
        
        .digital-clock {
            font-family: 'Montserrat', sans-serif;
            font-size: 5rem;
            font-weight: 800;
            color: var(--primary-dark);
            line-height: 1;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-shadow: 0 2px 10px rgba(26, 77, 140, 0.2);
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .timezone {
            font-size: 1.4rem;
            color: var(--primary-light);
            font-weight: 600;
            margin-top: 8px;
            opacity: 0.9;
        }
        
        .countdown-container {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--accent-blue) 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(46, 119, 187, 0.3);
        }
        
        .next-prayer-name {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 10px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .countdown-timer {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-light);
            letter-spacing: 1px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* HADIS & AYAT SECTION */
        .wisdom-section {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex: 1;
            border: 1px solid rgba(255, 255, 255, 0.9);
        }
        
        .wisdom-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 1;
            transition: opacity 0.8s ease-in-out;
            text-align: center;
            width: 100%;
            height: 100%;
        }
        
        .wisdom-text {
            font-size: 1.4rem;
            line-height: 1.7;
            color: var(--text-dark);
            font-style: italic;
            margin-bottom: 15px;
            padding: 0 15px;
            font-weight: 500;
            max-width: 100%;
        }
        
        .wisdom-reference {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: 700;
            font-style: normal;
            padding: 10px 20px;
            background: rgba(26, 77, 140, 0.08);
            border-radius: 50px;
            display: inline-block;
        }
        
        /* SIDEBAR KANAN - 65% */
        .sidebar-right {
            width: 65%;
            background-color: #e6e6e6;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            min-height: 0;
            box-shadow: var(--shadow);
        }
        
        .wallpaper-slider {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .wallpaper-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1.2s ease-in-out;
        }
        
        .wallpaper-slide.active {
            opacity: 1;
        }
        
        /* WALLPAPER */
        .wallpaper-1 {
            background-image: linear-gradient(rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25)), 
                              url('https://images.unsplash.com/photo-1548013146-72479768bada?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
        }
        
        .wallpaper-2 {
            background-image: linear-gradient(rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25)), 
                              url('https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
        }
        
        .wallpaper-3 {
            background-image: linear-gradient(rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25)), 
                              url('https://images.unsplash.com/photo-1545569341-9eb8b30979d9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
        }
        
        /* FOOTER - JADWAL SHALAT */
        .footer-container {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }
        
        .prayer-schedule {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #153a6e 100%);
            padding: 15px 0;
            position: relative;
            z-index: 5;
        }
        
        .prayer-schedule::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
            animation: shimmer-line 3s infinite linear;
        }
        
        @keyframes shimmer-line {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        .schedule-title {
            text-align: center;
            color: var(--text-light);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 0 20px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
        }
        
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            padding: 0 20px;
        }
        
        .prayer-item {
            background-color: rgba(255, 255, 255, 0.08);
            padding: 12px 8px;
            text-align: center;
            border-radius: 10px;
            margin: 0 3px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .prayer-item:hover {
            background-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }
        
        .prayer-item.active {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #3a8ce4 100%);
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(46, 119, 187, 0.4);
            z-index: 2;
        }
        
        .prayer-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer-active 3s infinite;
        }
        
        @keyframes shimmer-active {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .prayer-name {
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 600;
            margin-bottom: 8px;
            opacity: 0.9;
            text-transform: uppercase;
        }
        
        .prayer-item.active .prayer-name {
            opacity: 1;
            font-weight: 700;
        }
        
        .prayer-time {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text-light);
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }
        
        /* RUNNING TEXT */
        .marquee-container {
            background: linear-gradient(90deg, rgba(240, 247, 255, 0.9) 0%, rgba(255, 255, 255, 0.9) 100%);
            padding: 12px 0;
            overflow: hidden;
            border-top: 2px solid var(--primary-light);
            position: relative;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .marquee-track {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: max-content;
            display: flex;
            align-items: center;
            animation: marquee-very-slow 300s linear infinite;
        }
        
        .adab-item {
            white-space: nowrap;
            padding: 0 60px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
        }
        
        @keyframes marquee-very-slow {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100%); }
        }
        
        .adab-item i {
            margin-right: 12px;
            color: var(--accent-blue);
            font-size: 1.1rem;
        }
        
        /* STYLE UNTUK FULLSCREEN */
        body:fullscreen {
            overflow: hidden;
        }
        
        body:fullscreen .header {
            padding: 25px 40px;
        }
        
        body:fullscreen .masjid-name {
            font-size: 2.5rem;
        }
        
        body:fullscreen .digital-clock {
            font-size: 5.5rem;
        }
        
        body:fullscreen .wisdom-text {
            font-size: 1.5rem;
        }
        
        body:fullscreen .prayer-time {
            font-size: 1.8rem;
        }
        
        /* RESPONSIVE UNTUK TV BESAR (SCALING SAJA) */
        @media (min-width: 1921px) {
            /* HANYA PERBESAR FONT, TIDAK UBAH LAYOUT */
            body {
                zoom: 1.2;
            }
        }
        
        /* MEDIA QUERY UNTUK LAYAR KECIL - TETAP HORIZONTAL */
        @media (max-width: 1366px) {
            .main-container {
                padding: 15px;
                gap: 15px;
            }
            
            .digital-clock {
                font-size: 4.5rem;
            }
            
            .countdown-timer {
                font-size: 2.2rem;
            }
            
            .wisdom-text {
                font-size: 1.3rem;
            }
            
            .prayer-time {
                font-size: 1.5rem;
            }
        }
        
        /* HAPUS SEMUA MEDIA QUERY YANG UBAH KE VERTIKAL */
        /* TIDAK ADA @media (max-width: 1024px) LAGI */
        
        /* UNTUK LAYAR SANGAT KECIL - TETAP HORIZONTAL TAPI PERKECIL */
        @media (max-width: 768px) {
            /* HANYA PERKECIL, TIDAK UBAH LAYOUT */
            body {
                zoom: 0.9;
            }
            
            .header {
                flex-direction: row;
                padding: 15px 20px;
            }
            
            .masjid-name {
                font-size: 1.8rem;
            }
            
            .hijri-date {
                font-size: 1.3rem;
            }
            
            .main-container {
                flex-direction: row; /* PASTIKAN HORIZONTAL */
            }
        }
        
        /* ANIMASI */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Fullscreen Overlay */
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .fullscreen-overlay h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--accent-blue);
        }
        
        .fullscreen-overlay p {
            font-size: 1.3rem;
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .fullscreen-btn {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            font-family: 'Montserrat', sans-serif;
        }
        
        .fullscreen-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(46, 119, 187, 0.4);
        }
        
        /* Loading State */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .loading::after {
            content: 'Memuat...';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        /* Error State */
        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            color: #d32f2f;
            font-size: 0.9rem;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <!-- FULLSCREEN OVERLAY -->
    <div class="fullscreen-overlay" id="fullscreen-overlay">
        <h2>Display Digital Masjid Baiturrahman</h2>
        <p>Untuk pengalaman terbaik, tampilan akan dibuka dalam mode layar penuh. Klik tombol di bawah untuk melanjutkan.</p>
        <button class="fullscreen-btn" id="enter-fullscreen-btn">
            <i class="fas fa-expand"></i> Buka Layar Penuh
        </button>
    </div>
    
    <!-- HEADER -->
    <header class="header">
        <div class="date-section">
            <div class="hijri-date" id="hijri-date">17 Ramadhan 1445 H</div>
            <div class="gregorian-date" id="gregorian-date">Senin, 28 Maret 2024</div>
        </div>
        
        <div class="masjid-section">
            <h1 class="masjid-name">MASJID BAITURRAHMAN</h1>
            <p class="masjid-address">Jl. Raya Janti, Banguntapan, Bantul, Yogyakarta</p>
        </div>
    </header>
    
    <!-- MAIN CONTENT - HORIZONTAL -->
    <div class="main-container">
        <!-- SIDEBAR KIRI -->
        <div class="sidebar-left">
            <!-- TIMER SECTION -->
            <div class="timer-section">
                <div class="clock-container">
                    <div class="digital-clock" id="digital-clock">14:45</div>
                    <div class="timezone">WIB</div>
                </div>
                
                <div class="countdown-container">
                    <div class="next-prayer-name" id="next-prayer-name">Memuat...</div>
                    <div class="countdown-timer" id="countdown-timer">--:--:--</div>
                </div>
            </div>
            
            <!-- HADIS & AYAT SECTION -->
            <div class="wisdom-section">
                <div class="wisdom-content fade-in" id="wisdom-content">
                    <div class="wisdom-text" id="wisdom-text">
                        "Sesungguhnya shalat itu adalah kewajiban yang ditentukan waktunya atas orang-orang yang beriman."
                    </div>
                    <div class="wisdom-reference" id="wisdom-reference">QS. An-Nisa (4) : 103</div>
                </div>
            </div>
        </div>
        
        <!-- SIDEBAR KANAN -->
        <div class="sidebar-right">
            <div class="wallpaper-slider">
                <div class="wallpaper-slide wallpaper-1 active"></div>
                <div class="wallpaper-slide wallpaper-2"></div>
                <div class="wallpaper-slide wallpaper-3"></div>
            </div>
        </div>
    </div>
    
    <!-- FOOTER CONTAINER -->
    <div class="footer-container">
        <!-- ERROR MESSAGE -->
        <div class="error-message" id="error-message"></div>
        
        <!-- JADWAL SHALAT -->
        <footer class="prayer-schedule">
            <div class="schedule-title">JADWAL SHALAT HARI INI</div>
            <div class="prayer-grid" id="prayer-grid">
                <!-- Jadwal akan diisi oleh JavaScript -->
                <div class="prayer-item loading" style="grid-column: 1 / -1; height: 80px;">
                    <div class="prayer-name">Memuat jadwal...</div>
                </div>
            </div>
        </footer>
        
        <!-- RUNNING TEXT -->
        <div class="marquee-container">
            <div class="marquee-track" id="marquee-track">
                <!-- Adab akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // ==================== KONFIGURASI ====================
        const CONFIG = {
            MASJID: {
                name: "MASJID BAITURRAHMAN",
                address: "Jl. Raya Janti, Banguntapan, Bantul, Yogyakarta",
                cityCode: "1301", // Kode kota Yogyakarta untuk API MyQuran
                timezone: "WIB"
            },
            
            // Default jadwal (fallback jika API gagal)
            DEFAULT_PRAYER_TIMES: {
                "Subuh": "04:30",
                "Syuruq": "05:45", 
                "Dzuhur": "12:15",
                "Ashar": "15:30",
                "Maghrib": "18:20",
                "Isya": "19:45"
            },
            
            // Urutan sholat
            PRAYER_ORDER: ["Subuh", "Syuruq", "Dzuhur", "Ashar", "Maghrib", "Isya"],
            
            // API Endpoint (PUBLIC, NO API KEY NEEDED)
            API_ENDPOINT: "https://api.myquran.com/v1/sholat/jadwal"
        };
        
        // ==================== ADMIN DATA FETCHER ====================
        const ADMIN_BACKEND_URL = 'https://script.google.com/macros/s/AKfycbzsDOKEhe7C3S9q8dZYQHrY8IHet61bdCwroHRzUizvSl4LzY5nFQZ5cWIKEgBz0Yc7OA/exec'; // GANTI DENGAN URL LU!
        
        async function fetchAdminData() {
            try {
                const response = await fetch(ADMIN_BACKEND_URL);
                const data = await response.json();
                
                // Jika ada running text baru, update
                if (data.runningText && data.runningText.trim() !== '') {
                    updateRunningText(data.runningText);
                }
                
                // Jika ada wisdom baru, update
                if (data.wisdomText && data.wisdomText.trim() !== '') {
                    updateWisdom(data.wisdomText, data.wisdomRef);
                }
                
                // Jika ada wallpaper baru, update
                if (data.wallpaperUrl && data.wallpaperUrl.trim() !== '') {
                    updateWallpaper(data.wallpaperUrl);
                }
                
                console.log('Admin data updated successfully');
                
            } catch (error) {
                console.log('Failed to fetch admin data:', error);
                // Tetap jalan dengan data existing
            }
        }
        
        function updateRunningText(text) {
            // Buat atau update running text element
            let runningTextElement = document.getElementById('running-text');
            
            if (!runningTextElement) {
                // Jika belum ada, buat element baru
                const marqueeContainer = document.querySelector('.marquee-container');
                if (marqueeContainer) {
                    runningTextElement = document.createElement('div');
                    runningTextElement.id = 'running-text';
                    runningTextElement.className = 'adab-item';
                    runningTextElement.innerHTML = `<i class="fas fa-bullhorn"></i> ${text}`;
                    
                    // Kosongkan dan tambahkan yang baru
                    const marqueeTrack = document.getElementById('marquee-track');
                    if (marqueeTrack) {
                        marqueeTrack.innerHTML = '';
                        marqueeTrack.appendChild(runningTextElement);
                    }
                }
            } else {
                // Update yang sudah ada
                runningTextElement.innerHTML = `<i class="fas fa-bullhorn"></i> ${text}`;
            }
        }
        
        function updateWisdom(text, reference) {
            const wisdomText = document.getElementById('wisdom-text');
            const wisdomRef = document.getElementById('wisdom-reference');
            
            if (wisdomText) {
                wisdomText.textContent = text;
                wisdomText.style.fontStyle = 'italic';
            }
            
            if (wisdomRef && reference) {
                wisdomRef.textContent = reference;
                wisdomRef.style.fontStyle = 'normal';
            }
        }
        
        function updateWallpaper(url) {
            // Update wallpaper pertama dengan URL baru
            const wallpaper1 = document.querySelector('.wallpaper-1');
            if (wallpaper1 && url) {
                wallpaper1.style.backgroundImage = 
                    `linear-gradient(rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25)), url('${url}')`;
                
                // Juga update wallpaper lainnya sebagai backup
                const wallpapers = document.querySelectorAll('.wallpaper-slide');
                wallpapers.forEach((wallpaper, index) => {
                    if (index > 0) {
                        wallpaper.style.backgroundImage = 
                            `linear-gradient(rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25)), url('${url}')`;
                    }
                });
            }
        }
        
        // ==================== DATA STATIC ====================
        const WISDOMS = [
            {
                text: "Sesungguhnya shalat itu adalah kewajiban yang ditentukan waktunya atas orang-orang yang beriman.",
                reference: "QS. An-Nisa (4) : 103"
            },
            {
                text: "Barangsiapa yang shalat Subuh, maka ia berada dalam jaminan Allah.",
                reference: "HR. Muslim"
            },
            {
                text: "Amal pertama yang dihisab dari seorang hamba pada hari kiamat adalah shalat.",
                reference: "HR. Tirmidzi"
            },
            {
                text: "Shalat adalah tiang agama, barangsiapa mendirikannya maka ia telah mendirikan agama.",
                reference: "HR. Baihaqi"
            },
            {
                text: "Dua rakaat shalat sunnah Subuh lebih baik dari dunia dan seisinya.",
                reference: "HR. Muslim"
            }
        ];
        
        const ADABS = [
            "Masuk masjid dengan membaca doa dan menggunakan kaki kanan terlebih dahulu",
            "Menjaga kebersihan masjid dan tidak meninggalkan sampah di dalamnya",
            "Mematikan atau menyetel mode silent ponsel saat berada di dalam masjid",
            "Tidak lalu lalang di depan orang yang sedang shalat",
            "Membaca Al-Qur'an atau dzikir sebelum shalat dimulai"
        ];
        
        // ==================== STATE MANAGEMENT ====================
        let currentPrayerTimes = {};
        let lastUpdatedDate = null;
        let wisdomIndex = 0;
        let wallpaperIndex = 0;
        let isLoading = false;
        
        // ==================== PRAYER TIMES MANAGEMENT ====================
        class PrayerTimesManager {
            constructor() {
                this.cacheKey = 'masjid_prayer_times_cache';
                this.cacheDuration = 12 * 60 * 60 * 1000; // 12 jam
            }
            
            async getTodayPrayerTimes() {
                const today = new Date().toDateString();
                
                // 1. Cek cache dulu
                const cached = this.getFromCache();
                if (cached && cached.date === today) {
                    console.log('Menggunakan data cache');
                    return cached.times;
                }
                
                // 2. Coba fetch dari API
                try {
                    console.log('Fetching data dari API...');
                    const apiTimes = await this.fetchFromAPI();
                    
                    // Simpan ke cache
                    this.saveToCache({
                        date: today,
                        times: apiTimes,
                        timestamp: Date.now()
                    });
                    
                    return apiTimes;
                } catch (error) {
                    console.error('API Error:', error);
                    
                    // 3. Jika cache masih valid (kurang dari 24 jam), pakai cache lama
                    if (cached && (Date.now() - cached.timestamp) < 86400000) {
                        console.log('API gagal, menggunakan cache lama');
                        return cached.times;
                    }
                    
                    // 4. Jika semua gagal, pakai default
                    console.log('Menggunakan data default');
                    return CONFIG.DEFAULT_PRAYER_TIMES;
                }
            }
            
            async fetchFromAPI() {
                const today = new Date().toISOString().split('T')[0];
                const url = `${CONFIG.API_ENDPOINT}/${CONFIG.MASJID.cityCode}/${today}`;
                
                console.log('Fetching dari:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Validasi response
                if (!data.data || !data.data.jadwal) {
                    throw new Error('Format response tidak valid');
                }
                
                const jadwal = data.data.jadwal;
                
                return {
                    "Subuh": jadwal.subuh || "04:30",
                    "Syuruq": jadwal.terbit || "05:45",
                    "Dzuhur": jadwal.dzuhur || "12:15",
                    "Ashar": jadwal.ashar || "15:30",
                    "Maghrib": jadwal.maghrib || "18:20",
                    "Isya": jadwal.isya || "19:45"
                };
            }
            
            getFromCache() {
                try {
                    const cached = localStorage.getItem(this.cacheKey);
                    if (!cached) return null;
                    
                    const parsed = JSON.parse(cached);
                    
                    // Cek apakah cache masih valid (kurang dari cacheDuration)
                    if (Date.now() - parsed.timestamp > this.cacheDuration) {
                        return null;
                    }
                    
                    return parsed;
                } catch (error) {
                    console.error('Cache error:', error);
                    return null;
                }
            }
            
            saveToCache(data) {
                try {
                    localStorage.setItem(this.cacheKey, JSON.stringify(data));
                } catch (error) {
                    console.error('Gagal menyimpan cache:', error);
                }
            }
            
            clearCache() {
                localStorage.removeItem(this.cacheKey);
            }
        }
        
        // ==================== DOM MANIPULATION ====================
        async function initializePrayerSchedule() {
            const prayerGrid = document.getElementById('prayer-grid');
            
            try {
                isLoading = true;
                prayerGrid.innerHTML = `
                    <div class="prayer-item" style="grid-column: 1 / -1; height: 80px;">
                        <div class="prayer-name">Memuat jadwal...</div>
                    </div>
                `;
                
                const manager = new PrayerTimesManager();
                currentPrayerTimes = await manager.getTodayPrayerTimes();
                lastUpdatedDate = new Date().toDateString();
                
                // Update UI
                updatePrayerGridUI();
                updateDateTime(); // Hitung countdown dengan data baru
                
                // Sembunyikan error message jika ada
                document.getElementById('error-message').style.display = 'none';
                
            } catch (error) {
                console.error('Gagal memuat jadwal:', error);
                
                // Tampilkan error message
                const errorDiv = document.getElementById('error-message');
                errorDiv.textContent = 'Gagal memuat jadwal terkini. Menggunakan data cache.';
                errorDiv.style.display = 'block';
                
                // Pakai default
                currentPrayerTimes = CONFIG.DEFAULT_PRAYER_TIMES;
                updatePrayerGridUI();
            } finally {
                isLoading = false;
            }
        }
        
        function updatePrayerGridUI() {
            const prayerGrid = document.getElementById('prayer-grid');
            prayerGrid.innerHTML = '';
            
            CONFIG.PRAYER_ORDER.forEach(prayerName => {
                const prayerTime = currentPrayerTimes[prayerName] || '--:--';
                
                const prayerItem = document.createElement('div');
                prayerItem.className = 'prayer-item';
                prayerItem.id = `prayer-${prayerName.toLowerCase()}`;
                
                prayerItem.innerHTML = `
                    <div class="prayer-name">${prayerName}</div>
                    <div class="prayer-time">${prayerTime}</div>
                `;
                
                prayerGrid.appendChild(prayerItem);
            });
        }
        
        // ==================== DATE & TIME FUNCTIONS ====================
        function updateDateTime() {
            const now = new Date();
            
            // Update Jam Digital
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            // Buat efek kedip pada titik dua
            const colon = now.getSeconds() % 2 === 0 ? ":" : " ";
            document.getElementById('digital-clock').innerHTML = 
                `${hours}<span class="blink">${colon}</span>${minutes}`;
            
            // Update Tanggal Masehi
            const days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabu"];
            const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", 
                           "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const monthName = months[now.getMonth()];
            const year = now.getFullYear();
            
            document.getElementById('gregorian-date').textContent = 
                `${dayName}, ${date} ${monthName} ${year}`;
            
            // Update countdown jika data sudah ada
            if (Object.keys(currentPrayerTimes).length > 0) {
                updateCountdown(now);
                updateActivePrayer(now);
                updateCountdownEffects();
            }
        }
        
        function updateCountdown(now) {
            if (!currentPrayerTimes || Object.keys(currentPrayerTimes).length === 0) {
                document.getElementById('next-prayer-name').textContent = 'Memuat...';
                document.getElementById('countdown-timer').textContent = '--:--:--';
                return;
            }
            
            const currentTime = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
            
            // Cari shalat berikutnya
            let nextPrayerName = "Subuh";
            let nextPrayerTime = currentPrayerTimes["Subuh"];
            let found = false;
            
            for (let i = 0; i < CONFIG.PRAYER_ORDER.length; i++) {
                const prayerName = CONFIG.PRAYER_ORDER[i];
                const prayerTime = currentPrayerTimes[prayerName];
                
                if (!prayerTime || prayerTime === '--:--') continue;
                
                const [prayerHour, prayerMinute] = prayerTime.split(':').map(Number);
                const prayerSeconds = prayerHour * 3600 + prayerMinute * 60;
                
                if (prayerSeconds > currentTime) {
                    nextPrayerName = prayerName;
                    nextPrayerTime = prayerTime;
                    found = true;
                    break;
                }
            }
            
            // Jika tidak ada shalat berikutnya di hari ini, ambil Subuh besok
            if (!found) {
                nextPrayerName = "Subuh";
                nextPrayerTime = currentPrayerTimes["Subuh"];
            }
            
            // Hitung selisih waktu
            if (!nextPrayerTime || nextPrayerTime === '--:--') {
                document.getElementById('next-prayer-name').textContent = 'Data tidak tersedia';
                document.getElementById('countdown-timer').textContent = '--:--:--';
                return;
            }
            
            const [nextHour, nextMinute] = nextPrayerTime.split(':').map(Number);
            const nextPrayerSeconds = nextHour * 3600 + nextMinute * 60;
            
            let diffSeconds = nextPrayerSeconds - currentTime;
            
            // Jika shalat berikutnya besok (untuk kasus setelah Isya)
            if (diffSeconds < 0) {
                diffSeconds += 24 * 3600;
            }
            
            const hours = Math.floor(diffSeconds / 3600);
            const minutes = Math.floor((diffSeconds % 3600) / 60);
            const seconds = diffSeconds % 60;
            
            // Update UI
            document.getElementById('next-prayer-name').textContent = nextPrayerName;
            document.getElementById('countdown-timer').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        function updateActivePrayer(now) {
            if (!currentPrayerTimes || Object.keys(currentPrayerTimes).length === 0) return;
            
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const prayerItems = document.querySelectorAll('.prayer-item');
            
            prayerItems.forEach((item, index) => {
                item.classList.remove('active');
                
                const prayerName = CONFIG.PRAYER_ORDER[index];
                const prayerTime = currentPrayerTimes[prayerName];
                
                if (!prayerTime || prayerTime === '--:--') return;
                
                const [prayerHour, prayerMinute] = prayerTime.split(':').map(Number);
                const prayerTotalMinutes = prayerHour * 60 + prayerMinute;
                
                if (index > 0) {
                    const prevPrayerName = CONFIG.PRAYER_ORDER[index - 1];
                    const prevPrayerTime = currentPrayerTimes[prevPrayerName];
                    
                    if (!prevPrayerTime || prevPrayerTime === '--:--') return;
                    
                    const [prevHour, prevMinute] = prevPrayerTime.split(':').map(Number);
                    const prevTotalMinutes = prevHour * 60 + prevMinute;
                    
                    if (currentTime >= prevTotalMinutes && currentTime < prayerTotalMinutes) {
                        item.classList.add('active');
                    }
                }
            });
        }
        
        function updateCountdownEffects() {
            const countdownTimer = document.getElementById('countdown-timer');
            const countdownText = countdownTimer.textContent;
            
            if (countdownText === '--:--:--') return;
            
            const [h, m, s] = countdownText.split(':').map(Number);
            
            if (h === 0 && m < 5) {
                countdownTimer.style.color = '#FFD700';
                countdownTimer.style.animation = 'blink 1s infinite';
            } else {
                countdownTimer.style.color = 'var(--text-light)';
                countdownTimer.style.animation = 'none';
            }
        }
        
        // ==================== HIJRI DATE ====================
        function updateHijriDate() {
            const now = new Date();
            const hijriMonths = ["Muharram", "Safar", "Rabiul Awal", "Rabiul Akhir", 
                                "Jumadil Awal", "Jumadil Akhir", "Rajab", "Sya'ban", 
                                "Ramadhan", "Syawal", "Dzulqa'dah", "Dzulhijjah"];
            
            // Approximate calculation (bisa diganti dengan API Hijriyah nanti)
            const hijriYear = 1445;
            const hijriMonth = hijriMonths[8]; // Ramadhan
            const hijriDay = 17 + Math.floor(now.getDate() / 2);
            
            document.getElementById('hijri-date').textContent = 
                `${hijriDay} ${hijriMonth} ${hijriYear} H`;
        }
        
        // ==================== WISDOM ROTATOR ====================
        function rotateWisdom() {
            const wisdomContent = document.getElementById('wisdom-content');
            
            // Fade out
            wisdomContent.style.opacity = 0;
            
            setTimeout(() => {
                wisdomIndex = (wisdomIndex + 1) % WISDOMS.length;
                const wisdom = WISDOMS[wisdomIndex];
                
                document.getElementById('wisdom-text').textContent = wisdom.text;
                document.getElementById('wisdom-reference').textContent = wisdom.reference;
                
                // Fade in
                setTimeout(() => {
                    wisdomContent.style.opacity = 1;
                }, 50);
            }, 400);
        }
        
        // ==================== WALLPAPER ROTATOR ====================
        const wallpapers = document.querySelectorAll('.wallpaper-slide');
        
        function rotateWallpaper() {
            // Sembunyikan semua wallpaper
            wallpapers.forEach(wallpaper => {
                wallpaper.classList.remove('active');
            });
            
            // Tampilkan wallpaper berikutnya
            wallpaperIndex = (wallpaperIndex + 1) % wallpapers.length;
            wallpapers[wallpaperIndex].classList.add('active');
        }
        
        // ==================== ADAB MARQUEE ====================
        function createAdabMarquee() {
            const marqueeTrack = document.getElementById('marquee-track');
            marqueeTrack.innerHTML = '';
            
            // Tambahkan semua adab dengan spasi normal
            ADABS.forEach((adab, index) => {
                const adabItem = document.createElement('div');
                adabItem.className = 'adab-item';
                
                const icons = ['fas fa-door-open', 'fas fa-broom', 'fas fa-mobile-alt', 
                              'fas fa-walking', 'fas fa-book-quran'];
                adabItem.innerHTML = `<i class="${icons[index]}"></i> ${adab}`;
                
                marqueeTrack.appendChild(adabItem);
                
                // Tambahkan spasi besar antara item
                const space = document.createElement('div');
                space.style.padding = '0 100px';
                marqueeTrack.appendChild(space);
            });
            
            // Duplikat untuk looping smooth
            ADABS.forEach((adab, index) => {
                const adabItem = document.createElement('div');
                adabItem.className = 'adab-item';
                
                const icons = ['fas fa-door-open', 'fas fa-broom', 'fas fa-mobile-alt',
                              'fas fa-walking', 'fas fa-book-quran'];
                adabItem.innerHTML = `<i class="${icons[index]}"></i> ${adab}`;
                
                marqueeTrack.appendChild(adabItem);
                
                const space = document.createElement('div');
                space.style.padding = '0 100px';
                marqueeTrack.appendChild(space);
            });
        }
        
        // ==================== FULLSCREEN HANDLER ====================
        function enterFullscreen() {
            const elem = document.documentElement;
            
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) { /* Firefox */
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE/Edge */
                elem.msRequestFullscreen();
            }
        }
        
        // ==================== DAILY CHECK ====================
        function checkDailyUpdate() {
            const today = new Date().toDateString();
            
            if (lastUpdatedDate !== today) {
                console.log('Hari baru, update jadwal...');
                initializePrayerSchedule();
            }
        }
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Display Masjid v1.0 - Initializing...');
            
            // Initialize semua komponen
            updateHijriDate();
            createAdabMarquee();
            
            // Load jadwal sholat
            await initializePrayerSchedule();
            
            // Start interval updates
            setInterval(updateDateTime, 1000);
            updateDateTime(); // Initial call
            
            setInterval(rotateWisdom, 30000); // 30 detik
            setInterval(rotateWallpaper, 60000); // 60 detik
            setInterval(checkDailyUpdate, 60000); // Cek tiap menit
            
            // Fullscreen handler
            document.getElementById('enter-fullscreen-btn').addEventListener('click', function() {
                enterFullscreen();
                document.getElementById('fullscreen-overlay').style.display = 'none';
            });
            
            // Auto fullscreen setelah 2 detik
            setTimeout(() => {
                if (!document.fullscreenElement) {
                    document.getElementById('fullscreen-overlay').style.display = 'flex';
                }
            }, 2000);
            
            // Click anywhere to fullscreen
            document.addEventListener('click', function firstClick() {
                if (!document.fullscreenElement) {
                    enterFullscreen();
                    document.getElementById('fullscreen-overlay').style.display = 'none';
                }
                document.removeEventListener('click', firstClick);
            });
            
            // Handle fullscreen change
            document.addEventListener('fullscreenchange', function() {
                if (!document.fullscreenElement) {
                    // Jika keluar fullscreen, tampilkan overlay lagi
                    setTimeout(() => {
                        if (!document.fullscreenElement) {
                            document.getElementById('fullscreen-overlay').style.display = 'flex';
                        }
                    }, 1000);
                }
            });
            
            // Panggil admin data fetcher pertama kali setelah page load
            setTimeout(fetchAdminData, 5000);
            
            // Update admin data setiap 30 detik
            setInterval(fetchAdminData, 30000);
            
            console.log('Display Masjid v1.0 - Ready!');
        });
        
        // ==================== ERROR HANDLING ====================
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = 'Terjadi kesalahan sistem. Silakan refresh halaman.';
            errorDiv.style.display = 'block';
        });
        
        // Offline detection
        window.addEventListener('offline', function() {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = 'Koneksi internet terputus. Menggunakan data cache.';
            errorDiv.style.display = 'block';
        });
        
        window.addEventListener('online', function() {
            document.getElementById('error-message').style.display = 'none';
            
            // Coba update data jika offline lama
            checkDailyUpdate();
            fetchAdminData(); // Juga coba update data admin
        });
    </script>
</body>
</html>
